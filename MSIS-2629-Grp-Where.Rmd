---
title: "R Notebook"
output: html_notebook
editor_options: 
  chunk_output_type: console
---


```{r Libraries}

library(tidyverse)
library(xml2)

```


This datafeed file is maintained for the Voter Information Project to support the poll location API. Read more about the project here: http://votinginfoproject.org/. The datafeed file provides links to ZIP files containing XML files of polling place locations.

```{r Poll Locations Data}

feed <- readLines("https://raw.githubusercontent.com/votinginfoproject/VIP-feed-information-project/master/datafeed.txt")

zip_url <- feed %>% str_subset("feed_url") %>% str_sub(14,-2)


```

This is a loop to download all of the xml files and store their file paths in a list. This is just because I don't know anything about xml files and so I don't know how to convert them into data.frames. Help on this would be appreciated. 

But the bigger issue involves getting the loop to keep going even if a file download fails...There are 238 urls, and I only got 15 in my list because of a 404 error. Later attempts only got me 3 files because of an invalid arguement error.

```{r Polls Data loop}
xpolls <- list()
j <- 0
td <- tempdir()
tf <- tempfile(tmpdir=td, fileext=".zip")

for (z in zip_url) {
j <- j + 1
download.file(z, tf)
fname <- unzip(tf, list=TRUE)$Name[1]
unzip(tf, files=fname, exdir=td, overwrite=TRUE)
fpath <- file.path(td, fname)
xpolls[[j]] <- fpath
}


```


These links need to be updated with the github file locations.
```{r Mail Voting Data}

census <- read.csv("MSIS2629_TeamProject-master/Exploratory_Analysis/census_with_election_data.csv")

turnout <- census$total_votes/census$X18.and.over.population

census <- cbind(census,turnout)

vote <- read.csv("Early Voting.csv")

df <- left_join(census, vote, by=c('state.name'='State'))

df <- df %>% mutate(VoteByMail = case_when(df$No.Excuse.Absentee == 1 ~ "Any Voter", df$Absentee...Excuse.Required == 1 ~ "Excused Only", df$All.Mail.Voting == 1 ~ "All Voters")) %>% data.frame()

```


Some initial graphs to see the differences in voter turnout when vote by mail is an option.

```{r Mail Ballots Graphs}

ggplot(df, aes(VoteByMail,turnout)) + geom_boxplot()

ggplot(df, aes(factor(Permanent.Absentee.Status),turnout)) + geom_boxplot()

```
